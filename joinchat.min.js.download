((c,r,d)=>{d={$div:null,settings:null,store:null,chatbox:!1,showed_at:0,is_ready:!1,is_mobile:/Mobile|Android|iPhone|iPad/i.test(navigator.userAgent),can_qr:c.QrCreator&&"function"==typeof QrCreator.render,...d},(c.joinchat_obj=d).$=function(t){return this.$div.querySelector(t)},d.$$=function(t){return this.$div.querySelectorAll(t)},d.send_event=function(n){if((n={event_category:"JoinChat",event_label:"",event_action:"",chat_channel:"whatsapp",chat_id:"--",is_mobile:this.is_mobile?"yes":"no",page_location:location.href,page_title:r.title||"no title",...n}).event_label=n.event_label||n.link||"",n.event_action=n.event_action||n.chat_channel+": "+n.chat_id,delete n.link,r.dispatchEvent(new CustomEvent("joinchat:event",{detail:n,cancelable:!0}))){let t=c[this.settings.data_layer]||c[c.gtm4wp_datalayer_name]||c.dataLayer;if("object"==typeof t){"undefined"==typeof gtag&&(c.gtag=function(){t.push(arguments)});let e=this.settings.ga_event||"generate_lead",s={transport_type:"beacon",...n},a=(Object.keys(s).forEach(t=>{"page_location"===t?s[t]=s[t].substring(0,1e3):"page_referrer"===t?s[t]=s[t].substring(0,420):"page_title"===t?s[t]=s[t].substring(0,300):"string"==typeof s[t]&&(s[t]=s[t].substring(0,100))}),[]),i=t=>{a.includes(t)||(t.startsWith("G-")||t.startsWith("GT-"))&&(a.push(t),gtag("event",e,{send_to:t,...s}))};if(c.google_tag_data&&google_tag_data.tidr&&google_tag_data.tidr.destination)for(var o in google_tag_data.tidr.destination)i(o);t.forEach(t=>{"config"===t[0]&&t[1]&&i(t[1])}),this.settings.gads&&gtag("event","conversion",{send_to:this.settings.gads})}var e=n.event_category;delete n.event_category,"object"==typeof t&&t.push({event:e,...n}),"function"==typeof fbq&&fbq("trackCustom",e,n)}},d.get_wa_link=function(t,e,s){e=void 0!==e?e:this.settings.message_send||"",s=void 0!==s?s:this.settings.whatsapp_web&&!this.is_mobile;s=new URL((s?"https://web.whatsapp.com/send?phone=":"https://wa.me/")+(t||this.settings.telephone));return e&&s.searchParams.set("text",e),s.toString()},d.show=function(t){this.$div.removeAttribute("hidden"),this.$div.classList.add("joinchat--show"),t&&this.$div.classList.add("joinchat--tooltip")},d.hide=function(){this.$div.classList.remove("joinchat--show")},d.chatbox_show=function(){this.chatbox||(this.chatbox=!0,this.showed_at=Date.now(),this.$div.classList.add("joinchat--chatbox"),this.settings.message_badge&&this.$(".joinchat__badge").classList.replace("joinchat__badge--in","joinchat__badge--out"),r.dispatchEvent(new Event("joinchat:show")))},d.chatbox_hide=function(){this.chatbox&&(this.chatbox=!1,this.$div.classList.remove("joinchat--chatbox","joinchat--tooltip"),this.settings.message_badge&&this.$(".joinchat__badge").classList.remove("joinchat__badge--out"),r.dispatchEvent(new Event("joinchat:hide")))},d.save_hash=function(){var t;!this.settings.message_hash||this.settings.message_delay<0||(t=(this.store.getItem("joinchat_hashes")||"").split(",").filter(Boolean)).includes(this.settings.message_hash)||(t.push(this.settings.message_hash),this.store.setItem("joinchat_hashes",t.join(",")))},d.open_whatsapp=function(t,e){t=t||this.settings.telephone,e=void 0!==e?e:this.settings.message_send||"";t={link:this.get_wa_link(t,e),chat_channel:"whatsapp",chat_id:t,chat_message:e};r.dispatchEvent(new CustomEvent("joinchat:open",{detail:t,cancelable:!0}))&&(this.send_event(t),c.open(t.link,"joinchat","noopener"))},d.need_optin=function(){return this.$div.classList.contains("joinchat--optout")},d.use_qr=function(){return!!this.settings.qr&&this.can_qr&&!this.is_mobile},d.open=function(t,e,s){t&&!this.need_optin()||!d.$(".joinchat__chatbox")?Date.now()<d.showed_at+600||(this.save_hash(),this.open_whatsapp(e,s)):this.chatbox_show()},d.close=function(){this.save_hash(),this.chatbox_hide()},d.rand_text=function(t){t.querySelectorAll("jc-rand").forEach(t=>{var e=t.children;t.replaceWith(e[Math.floor(Math.random()*e.length)].innerHTML)})},d.qr=function(t,e){var s=r.createElement("CANVAS");return QrCreator.render(Object.assign({text:t,radius:.4,background:"#FFF",size:200*(c.devicePixelRatio||1)},this.settings.qr||{},e||{}),s),s};var t=()=>{if(d.$div=r.querySelector(".joinchat"),d.$div){d.settings=JSON.parse(d.$div.dataset.settings);try{localStorage.test=2,d.store=localStorage}catch(t){d.store={_data:{},setItem:function(t,e){this._data[t]=String(e)},getItem:function(t){return this._data.hasOwnProperty(t)?this._data[t]:null}}}if(d.settings&&d.settings.telephone){if(d.is_mobile||!d.settings.mobile_only){r.dispatchEvent(new Event("joinchat:starting"));var i=1e3*d.settings.button_delay,n=Math.max(0,1e3*d.settings.message_delay);let t=!!d.settings.message_hash;var o=parseInt(d.store.getItem("joinchat_views")||1)>=d.settings.message_views,h=(d.store.getItem("joinchat_hashes")||"").split(",").filter(Boolean);let s=void 0!==d.settings.cta_viewed?d.settings.cta_viewed:-1!==h.indexOf(d.settings.message_hash||"none"),e=!s&&(d.settings.message_badge||!t||!n||!o),a=(setTimeout(()=>d.show(e),i),()=>d.open());if(t&&!s&&n){let t;d.settings.message_badge?t=setTimeout(()=>d.$(".joinchat__badge").classList.add("joinchat__badge--in"),i+n):o&&(t=setTimeout(a,i+n)),r.addEventListener("joinchat:show",()=>clearTimeout(t),{once:!0})}if(h=d.$(".joinchat__button"),!d.is_mobile){let t;h.addEventListener("mouseenter",()=>{d.$(".joinchat__chatbox")&&(t=setTimeout(a,1500))}),h.addEventListener("mouseleave",()=>{clearTimeout(t)})}if(h.addEventListener("click",a),d.$(".joinchat__open")?.addEventListener("click",()=>d.open(!0)),d.$(".joinchat__close")?.addEventListener("click",()=>d.close()),d.$("#joinchat_optin")?.addEventListener("change",t=>d.$div.classList.toggle("joinchat--optout",!t.target.checked)),d.$(".joinchat__scroll")?.addEventListener("wheel",function(t){t.preventDefault(),this.scrollTop+=t.deltaY},{passive:!1}),d.is_mobile){let e,t,s=()=>{var t=(r.activeElement.type||"").toLowerCase();["date","datetime","email","month","number","password","search","tel","text","textarea","time","url","week"].includes(t)?d.chatbox?(d.chatbox_hide(),setTimeout(()=>d.hide(),400)):d.hide():d.show()};["focusin","focusout"].forEach(t=>r.addEventListener(t,t=>{t.target.matches("input, textarea")&&!d.$div.contains(t.target)&&(clearTimeout(e),e=setTimeout(s,200))})),c.addEventListener("resize",()=>{clearTimeout(t),t=setTimeout(()=>{d.$div.style.setProperty("--vh",c.innerHeight+"px")},200)}),c.dispatchEvent(new Event("resize"))}if(d.use_qr()?d.$(".joinchat__qr").appendChild(d.qr(d.get_wa_link(void 0,void 0,!1))):d.$(".joinchat__qr")?.remove(),n&&!o&&d.store.setItem("joinchat_views",parseInt(d.store.getItem("joinchat_views")||0)+1),r.addEventListener("joinchat:show",()=>{let s=d.$(".joinchat__scroll"),e=d.$(".joinchat__chat"),a=d.$$(".joinchat__bubble");if(!e)return;if(t&&d.rand_text(e),a.length<=1||c.matchMedia("(prefers-reduced-motion)").matches)return void setTimeout(()=>e.dispatchEvent(new Event("joinchat:bubbles")),1);a.forEach(t=>t.classList.add("joinchat--hidden")),d.$(".joinchat__optin")?.classList.add("joinchat--hidden");let i=0,n=(t,e)=>Math.round(Math.random()*(e-t)+t),o=(t,e)=>{d.$(".joinchat__bubble--loading")?.remove(),t.classList.remove("joinchat--hidden"),s.scrollTop=s.scrollHeight,setTimeout(h,e)},h=()=>{if(i>=a.length)d.$(".joinchat__optin")?.classList.remove("joinchat--hidden"),e.dispatchEvent(new Event("joinchat:bubbles"));else{let t=a[i++];t.classList.contains("joinchat__bubble--note")?o(t,100):(e.insertAdjacentHTML("beforeend",'<div class="joinchat__bubble joinchat__bubble--loading"></div>'),s.scrollTop=s.scrollHeight,setTimeout(()=>o(t,n(400,600)),60*t.textContent.split(/\s+/).length+n(100,200)))}};h()},{once:!0}),"#joinchat"!==(i=new URL(c.location)).hash&&!i.searchParams.has("joinchat")||(h=1e3*(parseInt(i.searchParams.get("joinchat"))||0),setTimeout(()=>d.show(),h),setTimeout(()=>d.chatbox_show(),700+h)),r.addEventListener("click",t=>{var e;t.target.closest('.joinchat_open, .joinchat_app, a[href="#joinchat"], a[href="#whatsapp"]')&&(t.preventDefault(),e=!!t.target.closest('.joinchat_app, a[href="#whatsapp"]'),d.open(e,t.target.dataset.phone,t.target.dataset.message))}),r.addEventListener("click",t=>{t.target.closest(".joinchat_close")&&(t.preventDefault(),d.close())}),n=r.querySelectorAll(".joinchat_show, .joinchat_force_show"),t&&n&&"IntersectionObserver"in c){let e=new IntersectionObserver(t=>{t.forEach(t=>{t.intersectionRatio<=0||s&&!t.target.classList.contains("joinchat_force_show")||(e.disconnect(),a())})});n.forEach(t=>e.observe(t))}d.is_ready=!0,r.dispatchEvent(new Event("joinchat:start"))}else d.hide(),r.addEventListener("click",t=>{t.target.closest('.joinchat_open, .joinchat_app, a[href="#joinchat"], a[href="#whatsapp"]')&&(t.preventDefault(),d.open_whatsapp(t.target.dataset.phone,t.target.dataset.message))});if(d.can_qr&&!d.is_mobile?r.querySelectorAll(".joinchat-button__qr").forEach(t=>t.appendChild(d.qr(d.get_wa_link(t.dataset.phone,t.dataset.message,!1)))):r.querySelectorAll(".wp-block-joinchat-button figure").forEach(t=>t.remove()),void 0!==d.settings.sku&&"function"==typeof jQuery){let a=d.settings.message_send;jQuery("form.variations_form").on("found_variation reset_data",function(t,e){let s=e&&e.sku||d.settings.sku;d.$$(".joinchat__chat jc-sku").forEach(t=>t.textContent=s),d.settings.message_send=a.replace(/<jc-sku>.*<\/jc-sku>/g,s)})}}}};"loading"!==r.readyState?t():r.addEventListener("DOMContentLoaded",t)})(window,document,window.joinchat_obj||{});